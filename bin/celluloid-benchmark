#! /usr/bin/env ruby

require_relative "../lib/celluloid_benchmark"
require_relative "../lib/celluloid_benchmark/visitor"

session_path = File.expand_path(ARGV[0])

duration = (ARGV[1] || 20).to_i
if duration == 0
  duration = 20
end

benchmark_run = CelluloidBenchmark::Runner.run session_path, duration, ARGV[2] && ARGV[2].to_i

p benchmark_run
puts
p "#{benchmark_run.requests / benchmark_run.elapsed_time} requests per second. #{benchmark_run.requests} requests in #{benchmark_run.elapsed_time} seconds by #{benchmark_run.visitors} visitors."

puts
benchmark_run.benchmarks.each do |trans|
  puts "#{trans.ok? ? '[ OK ]' : '[FAIL]'} #{trans.label}"
end

exit benchmark_run.ok?

#! /usr/bin/env ruby

require_relative "../lib/celluloid_benchmark"
require_relative "../lib/celluloid_benchmark/visitor"

benchmark_run = CelluloidBenchmark::Runner.run ENV['SESSION'], ENV['DURATION'], ENV['VISITORS'], ENV['TARGET']

p benchmark_run
puts
p "#{benchmark_run.requests / benchmark_run.elapsed_time} requests per second. #{benchmark_run.requests} requests in #{benchmark_run.elapsed_time} seconds by #{benchmark_run.visitors} visitors."

puts
benchmark_run.benchmarks.each do |trans|
  puts "#{trans.ok? ? '[ OK ]' : '[FAIL]'} #{trans.label}"
end

exit benchmark_run.ok?
